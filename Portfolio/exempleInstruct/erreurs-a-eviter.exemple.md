# Erreurs √† √©viter dans le d√©veloppement du Portfolio

Ce document recense les erreurs courantes √† √©viter lors du d√©veloppement de l'application Portfolio. Avant toute action de d√©veloppement, consultez ce guide pour √©viter de reproduire des erreurs connues et suivre les bonnes pratiques.

## Erreurs de commandes Shell

### Commandes Windows PowerShell

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| `dir /s /b` | `dir -Recurse` | PowerShell utilise des param√®tres avec tiret, pas des commutateurs slash comme cmd |
| `dir app /s` | `Get-ChildItem -Path app -Recurse` | Utiliser la syntaxe PowerShell compl√®te pour les commandes complexes |
| `cd ./chemin/avec/slash` | `cd .\chemin\avec\backslash` | Utiliser des backslashes (\) dans les chemins Windows |
| `mkdir dossier1 dossier2` | `New-Item -ItemType Directory -Path dossier1, dossier2` | Cr√©er plusieurs dossiers en une commande |
| `rm -rf dossier` | `Remove-Item -Recurse -Force dossier` | Ne pas utiliser la syntaxe Unix pour supprimer des dossiers |
| `mkdir app\api app\lib` | `mkdir app\api` puis `mkdir app\lib` | PowerShell ne peut pas cr√©er plusieurs dossiers avec la commande mkdir simple |
| `mkdir "app\(auth)\login" "app\(auth)\register"` | Cr√©er les dossiers un par un | Les caract√®res sp√©ciaux comme les parenth√®ses peuvent causer des probl√®mes |

### Chemins d'acc√®s

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Utiliser des chemins absolus cod√©s en dur | Utiliser des chemins relatifs | Les chemins absolus ne fonctionneront pas sur d'autres machines |
| Ignorer les espaces dans les chemins | `"C:\Chemin avec espaces\"` | Toujours mettre entre guillemets les chemins contenant des espaces |
| M√©langer / et \ dans les chemins | Utiliser uniquement \ pour Windows | Coh√©rence dans l'utilisation des s√©parateurs de chemin |
| Ignorer la casse des noms de fichiers | Respecter la casse exacte | M√™me si Windows est insensible √† la casse, maintenir la coh√©rence |

## Erreurs de syntaxe et de codage

### JavaScript/TypeScript

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| `var` pour les variables | `const` ou `let` | √âviter `var` qui a une port√©e de fonction et peut causer des fuites |
| `==` pour les comparaisons | `===` | Toujours utiliser l'√©galit√© stricte pour √©viter les conversions implicites |
| Fonctions anonymes partout | Fonctions nomm√©es | Nommer les fonctions pour faciliter le d√©bogage |
| Promesses imbriqu√©es | Async/await | √âviter l'enfer des callbacks avec async/await |
| `console.log` en production | Logger structur√© | Utiliser un syst√®me de logging appropri√© en production |
| Manipulation directe du DOM | Utiliser les hooks React | Ne pas m√©langer React avec des manipulations DOM directes |

### React/Next.js

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Utiliser `useState` pour des donn√©es d√©riv√©es | Calculer les valeurs dans le rendu | Ne stocker dans l'√©tat que ce qui ne peut pas √™tre d√©riv√© |
| Appels API dans les composants | Utiliser SWR ou React Query | Centraliser la logique de donn√©es avec des hooks d√©di√©s |
| Logique complexe dans les composants | Custom hooks | Extraire la logique complexe dans des hooks personnalis√©s |
| Ignorer les cl√©s dans les listes | Utiliser des cl√©s uniques et stables | Les cl√©s aident React √† identifier les √©l√©ments modifi√©s |
| M√©langer les approches SSR et CSR | Choisir consciemment | Comprendre quand utiliser getServerSideProps, getStaticProps, etc. |
| Ignorer les types | Typer correctement | Utiliser TypeScript correctement pour √©viter les erreurs √† l'ex√©cution |
| Oublier d'ajouter "use client" | Ajouter "use client" aux composants interactifs | Les composants qui utilisent des hooks ou des √©v√©nements doivent √™tre marqu√©s "use client" |
| Ne pas utiliser forwardRef pour les composants de formulaire | Utiliser forwardRef | Permet l'utilisation avec des biblioth√®ques de formulaires comme React Hook Form |

### Composants UI

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Hardcoder les styles dans les composants | Utiliser des props pour la personnalisation | Rendre les composants flexibles et r√©utilisables |
| Ignorer l'accessibilit√© | Ajouter des attributs ARIA | Rendre les composants accessibles aux technologies d'assistance |
| Ne pas g√©rer les √©tats de chargement | Ajouter des √©tats de chargement | Am√©liorer l'exp√©rience utilisateur pendant les op√©rations asynchrones |
| Composants trop sp√©cifiques | Cr√©er des composants g√©n√©riques | Concevoir des composants r√©utilisables dans diff√©rents contextes |
| Ignorer les props de base HTML | √âtendre les interfaces de props | Permettre de passer des attributs HTML standard aux composants |
| Ne pas documenter les props | Documenter clairement les props | Faciliter l'utilisation des composants par d'autres d√©veloppeurs |
| Ne pas utiliser forwardRef pour les composants de formulaire | Utiliser forwardRef | Permettre l'utilisation avec des biblioth√®ques de formulaires comme React Hook Form |
| G√©n√©rer des IDs al√©atoires pour les champs de formulaire | Utiliser des IDs stables bas√©s sur le nom ou le label | √âviter les erreurs d'hydratation dues √† des IDs diff√©rents entre le serveur et le client |
| Ne pas g√©rer les √©tats d'erreur dans les composants de formulaire | Ajouter des props pour g√©rer les erreurs | Permettre d'afficher des messages d'erreur et de styliser les champs en erreur |
| Cr√©er des composants sans variantes | Ajouter des props pour les variantes | Permettre de personnaliser l'apparence des composants sans dupliquer le code |
| Ne pas g√©rer les √©tats d√©sactiv√©s | Ajouter des props pour les √©tats d√©sactiv√©s | Permettre de d√©sactiver les composants interactifs |
| Ne pas cr√©er de composants composables | Utiliser le pattern de composition | Permettre de combiner les composants de mani√®re flexible |
| Oublier d'ajouter "use client" aux composants interactifs | Ajouter "use client" | Les composants qui utilisent des hooks ou des √©v√©nements doivent √™tre marqu√©s "use client" |
| Ne pas exporter les composants dans un fichier index | Cr√©er un fichier index.ts pour exporter tous les composants | Faciliter l'importation des composants |
| Styles globaux qui entrent en conflit | Utiliser des classes CSS modulaires ou Tailwind | √âviter les conflits de style avec une approche modulaire |

### Layouts et navigation

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Hardcoder les routes | Utiliser des constantes pour les routes | Faciliter la maintenance et √©viter les erreurs de frappe |
| Ignorer les r√¥les utilisateur | Adapter la navigation selon le r√¥le | Afficher uniquement les routes pertinentes pour chaque utilisateur |
| Oublier les √©tats de chargement | Ajouter des √©tats de chargement | Am√©liorer l'exp√©rience utilisateur pendant les transitions |
| N√©gliger la navigation mobile | Concevoir pour mobile d'abord | Assurer une exp√©rience utilisateur coh√©rente sur tous les appareils |
| Oublier d'importer des hooks utilis√©s | V√©rifier tous les imports n√©cessaires | √âviter les erreurs de compilation et les comportements inattendus |
| Ne pas fournir de fil d'Ariane | Ajouter un composant Breadcrumb | Aider les utilisateurs √† comprendre o√π ils se trouvent dans l'application |
| Cr√©er des layouts non r√©utilisables | Concevoir des composants modulaires | Permettre la r√©utilisation des √©l√©ments de layout dans diff√©rentes parties de l'application |
| Ne pas g√©rer les clics en dehors des menus d√©roulants | Ajouter des gestionnaires de clics ext√©rieurs | Am√©liorer l'exp√©rience utilisateur en fermant les menus lorsque l'utilisateur clique ailleurs |
| Ne pas standardiser les titres de page | Cr√©er un composant PageTitle | Assurer une pr√©sentation coh√©rente des titres de page dans toute l'application |
| Oublier d'ajouter un footer | Ajouter un composant Footer | Fournir des informations importantes comme les droits d'auteur et les liens utiles |

### Tableaux de bord

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Ne pas adapter l'interface au r√¥le de l'utilisateur | Filtrer les √©l√©ments d'interface selon le r√¥le | Chaque utilisateur doit voir uniquement ce qui est pertinent pour lui |
| Cr√©er des tableaux de bord g√©n√©riques | Personnaliser les tableaux de bord par r√¥le | Les diff√©rents types d'utilisateurs ont des besoins diff√©rents |
| Utiliser des donn√©es statiques dans les composants | Pr√©parer les composants pour des donn√©es dynamiques | Les donn√©es r√©elles viendront de la base de donn√©es |
| Surcharger le tableau de bord avec trop d'informations | Prioriser les informations importantes | Trop d'informations rend l'interface confuse et difficile √† utiliser |
| Navigation non intuitive | Organiser la navigation de mani√®re logique | La navigation doit √™tre claire et facile √† comprendre |
| Ignorer les √©tats vides | G√©rer les √©tats vides avec des messages explicatifs | Indiquer clairement √† l'utilisateur quand il n'y a pas de donn√©es |

### CSS/Tailwind

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| CSS global excessif | CSS modulaire ou Tailwind | √âviter les conflits de style avec une approche modulaire |
| Classes Tailwind trop longues | Extraire en composants | Utiliser @apply ou cr√©er des composants pour le code r√©p√©titif |
| M√©langer unit√©s (px, rem, em) | Standardiser les unit√©s | Utiliser rem pour la typographie, px pour les bordures, etc. |
| Media queries incoh√©rentes | Utiliser les breakpoints Tailwind | Maintenir la coh√©rence des points de rupture |
| Styles en ligne | Utiliser Tailwind ou CSS modules | √âviter les styles en ligne sauf pour les valeurs dynamiques |

## Erreurs d'authentification et de s√©curit√©

### Supabase Auth

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Utiliser directement les m√©thodes d'authentification sans gestion d'erreurs | Capturer et afficher les erreurs | Les erreurs d'authentification doivent √™tre explicites pour am√©liorer l'exp√©rience utilisateur |
| Ne pas g√©rer la session Supabase | Utiliser `onAuthStateChange` | √âcouter les changements d'√©tat d'authentification pour mettre √† jour l'UI |
| Utiliser directement les m√©thodes Supabase dans les composants | Cr√©er un hook personnalis√© | Centraliser la logique d'authentification dans un hook r√©utilisable |
| Oublier de typer les r√©ponses de Supabase | Cr√©er des types personnalis√©s | D√©finir des types pour les utilisateurs et les profils |
| Utiliser la m√™me redirection pour tous les r√¥les | Rediriger en fonction du r√¥le | Chaque type d'utilisateur doit √™tre redirig√© vers son tableau de bord sp√©cifique |
| Ne pas v√©rifier les r√¥les dans le middleware | Impl√©menter des v√©rifications de r√¥les | Prot√©ger les routes en fonction des r√¥les des utilisateurs |
| Exposer la cl√© de service Supabase c√¥t√© client | N'utiliser que la cl√© anonyme c√¥t√© client | La cl√© de service donne des droits d'administration et ne doit jamais √™tre expos√©e |
| Ne pas configurer les redirections dans Supabase Auth | Configurer les URLs de redirection | D√©finir les URLs de redirection pour les diff√©rentes actions d'authentification |
| Exiger des variables d'environnement non essentielles | Rendre optionnelles les variables non critiques | Utiliser un param√®tre `required` pour les variables d'environnement |
| Utiliser des groupes de routes avec parenth√®ses | Utiliser des dossiers normaux pour les routes | Les groupes de routes peuvent causer des probl√®mes avec la navigation |
| Utiliser une fonction personnalis√©e pour acc√©der aux variables d'environnement | Acc√©der directement √† `process.env` | Les fonctions personnalis√©es peuvent causer des probl√®mes avec Next.js |
| Oublier de d√©finir les variables d'environnement dans `next.config.js` | D√©finir les variables d'environnement dans `next.config.js` | Assure que les variables sont disponibles pendant le build et le runtime |
| Ne pas g√©rer la persistance de session | Utiliser `supabase.auth.getSession()` | V√©rifier la session au chargement de l'application |
| Oublier de configurer les politiques RLS | Configurer les politiques RLS | Prot√©ger les donn√©es avec Row Level Security |
| Configurer des politiques RLS circulaires | √âviter les d√©pendances circulaires dans les politiques RLS | Les politiques qui d√©pendent mutuellement l'une de l'autre peuvent emp√™cher l'insertion de donn√©es |
| Ne pas g√©rer les tokens expir√©s | Impl√©menter un rafra√Æchissement automatique | Utiliser les fonctionnalit√©s de rafra√Æchissement de token de Supabase |
| Configurer des politiques RLS trop permissives | Limiter l'acc√®s aux donn√©es en fonction du r√¥le | Par exemple, seuls les administrateurs devraient pouvoir voir tous les profils |
| Ne pas tester les politiques RLS | Cr√©er des scripts de test pour v√©rifier les politiques RLS | V√©rifier que chaque r√¥le a acc√®s uniquement aux donn√©es auxquelles il est autoris√© |
| Oublier de cr√©er des pages pour toutes les fonctionnalit√©s d'authentification | Cr√©er des pages pour chaque fonctionnalit√© | Impl√©menter des pages pour la connexion, l'inscription, la d√©connexion et la r√©initialisation de mot de passe |
| Ne pas tester le syst√®me d'authentification | Cr√©er des tests unitaires | Tester les fonctions d'authentification, le middleware et les pages d'authentification |
| Tester uniquement le "happy path" | Tester √©galement les cas d'erreur | S'assurer que les erreurs sont correctement g√©r√©es et affich√©es |
| Tester directement les hooks React | Tester les fonctions sous-jacentes | Les hooks React ne peuvent √™tre appel√©s que dans des composants React |
| Utiliser des tests trop complexes | Simplifier les tests | Des tests simples sont plus faciles √† maintenir et √† d√©boguer |
| Utiliser session?.user?.name directement | Utiliser user?.email | Supabase Auth ne fournit pas directement le nom de l'utilisateur |
| Utiliser signOut avec callbackUrl | G√©rer la redirection manuellement | Supabase Auth ne prend pas en charge callbackUrl pour signOut |
| Laisser des r√©f√©rences √† NextAuth.js apr√®s la migration | Supprimer toutes les r√©f√©rences | V√©rifier tous les fichiers pour s'assurer qu'il n'y a plus de r√©f√©rences √† NextAuth.js |
| Oublier de supprimer les fichiers de configuration NextAuth.js | Supprimer les fichiers inutiles | Supprimer les fichiers auth-options.ts et autres fichiers sp√©cifiques √† NextAuth.js |
| Utiliser pathname.startsWith() pour v√©rifier les routes | Utiliser pathname === route || pathname.startsWith(`${route}/`) | V√©rifier exactement la route ou si elle commence par la route suivie d'un slash |
| Ne pas configurer correctement le matcher du middleware | Ajouter des routes sp√©cifiques au matcher | S'assurer que le matcher capture toutes les routes prot√©g√©es |
| Ne pas g√©rer les erreurs de r√©cup√©ration de profil | Ajouter une gestion d'erreur compl√®te | V√©rifier le code d'erreur et cr√©er un profil par d√©faut si n√©cessaire |
| Utiliser console.error sans d√©tails | Inclure l'erreur compl√®te dans les logs | Facilite le d√©bogage en fournissant plus d'informations sur l'erreur |
| Oublier de g√©rer les exceptions lors de la cr√©ation de profil | Utiliser try/catch | Permet de capturer les erreurs inattendues lors de la cr√©ation de profil |
| Ne pas v√©rifier si la session est mise √† jour apr√®s la connexion | V√©rifier explicitement la session | S'assurer que la session est correctement mise √† jour apr√®s la connexion |
| Afficher des messages d'erreur g√©n√©riques | Afficher des messages d'erreur sp√©cifiques | Permet √† l'utilisateur de comprendre ce qui s'est pass√© et comment r√©soudre le probl√®me |
| Cr√©er des politiques RLS r√©cursives | √âviter les r√©f√©rences circulaires dans les politiques | Les politiques r√©cursives peuvent causer des erreurs 'infinite recursion' |
| Ne pas g√©rer les erreurs de r√©cursion infinie | Ajouter une gestion sp√©cifique pour ces erreurs | Permet d'√©viter de bloquer l'application en cas d'erreur de r√©cursion infinie |
| Ne pas mettre en place de m√©canisme de secours | Pr√©voir un comportement par d√©faut en cas d'erreur | Permet √† l'application de continuer √† fonctionner m√™me en cas d'erreur |
| Utiliser router.push imm√©diatement apr√®s la connexion | Ajouter un d√©lai et utiliser window.location.href | Permet de s'assurer que la session est correctement √©tablie avant la redirection |
| Ne pas configurer correctement le client Supabase | Configurer explicitement les options d'authentification | S'assurer que les sessions sont correctement persist√©es |
| Ne pas v√©rifier les cookies de session | Ajouter des logs pour v√©rifier les cookies | Permet de comprendre si les cookies de session sont correctement d√©finis |
| Ne pas g√©rer les erreurs d'hydratation React | Utiliser useEffect et useState pour √©viter les probl√®mes d'hydratation | √âvite les erreurs d'hydratation qui peuvent bloquer le rendu de l'application |
| Utiliser des composants qui d√©pendent de window/document directement | Utiliser useEffect pour s'assurer que le code s'ex√©cute uniquement c√¥t√© client | √âvite les erreurs d'hydratation li√©es √† l'acc√®s √† window/document |
| Ne pas ajouter d'en-t√™tes Cache-Control dans les r√©ponses | Ajouter des en-t√™tes Cache-Control pour √©viter les probl√®mes de mise en cache | √âvite les probl√®mes d'hydratation li√©s √† la mise en cache |
| Ne pas utiliser le localStorage pour stocker la session | Utiliser le localStorage pour stocker la session en plus des cookies | Permet de s'assurer que la session est correctement persist√©e |
| Ne pas configurer le stockage personnalis√© pour Supabase | Configurer un stockage personnalis√© pour Supabase | Permet de contr√¥ler pr√©cis√©ment comment les sessions sont stock√©es |
| Ne pas ajouter d'en-t√™tes CORS | Ajouter des en-t√™tes CORS pour √©viter les probl√®mes de cookies | Permet aux cookies d'√™tre correctement d√©finis et lus |
| Utiliser un syst√®me d'authentification trop complexe | Simplifier l'authentification en utilisant directement le localStorage | √âvite les probl√®mes de persistance de session et de redirection |
| D√©pendre uniquement des cookies pour l'authentification | Utiliser une combinaison de cookies et localStorage | Offre une solution de secours en cas de probl√®me avec les cookies |
| Utiliser un contexte React pour l'authentification | Utiliser des fonctions d'authentification simples et directes | √âvite les probl√®mes de synchronisation entre le contexte et l'√©tat r√©el |
| Ne pas tester l'authentification avec diff√©rents r√¥les | Cr√©er des scripts de test pour chaque r√¥le | Permet de s'assurer que le contr√¥le d'acc√®s bas√© sur les r√¥les fonctionne correctement |
| Ne pas v√©rifier les informations utilisateur apr√®s la connexion | V√©rifier explicitement les informations utilisateur dans le localStorage | Permet de s'assurer que les informations utilisateur sont correctement stock√©es |
| Ne pas tester l'acc√®s aux pages prot√©g√©es | Tester l'acc√®s aux pages prot√©g√©es pour chaque r√¥le | Permet de s'assurer que le contr√¥le d'acc√®s fonctionne correctement |
| Avoir plusieurs syst√®mes d'authentification | Unifier le syst√®me d'authentification | √âvite les conflits et les incoh√©rences entre diff√©rents syst√®mes d'authentification |
| Ne pas nettoyer les cookies et le localStorage avant la connexion | Nettoyer les cookies et le localStorage avant la connexion | √âvite les conflits entre diff√©rentes sessions |
| Ne pas centraliser le traitement des sessions | Cr√©er une fonction d√©di√©e pour traiter les sessions | Facilite la maintenance et la coh√©rence du code |
| Utiliser window.location.href pour les redirections | Utiliser le router Next.js pour les redirections normales, mais window.location.href pour les redirections apr√®s connexion | Le router Next.js est plus fluide, mais window.location.href est plus fiable pour les redirections apr√®s connexion |
| G√©n√©rer des IDs al√©atoires pour les champs de formulaire | Utiliser des IDs stables bas√©s sur le nom ou le label du champ | √âvite les erreurs d'hydratation dues √† des IDs diff√©rents entre le serveur et le client |
| Ne pas ajouter de d√©lai avant la redirection apr√®s connexion | Ajouter un d√©lai avec setTimeout avant la redirection | Permet de s'assurer que la session est bien √©tablie avant la redirection |
| Ne pas v√©rifier les pages publiques dans le middleware | V√©rifier si l'utilisateur est d√©j√† sur une page publique avant de rediriger | √âvite les boucles infinies de redirection |
| Utiliser uniquement la cl√© par d√©faut pour stocker la session | Stocker la session avec plusieurs cl√©s dans le localStorage | Certaines versions de Supabase utilisent des cl√©s diff√©rentes pour stocker la session |
| Ne pas stocker l'URL de redirection dans le localStorage | Stocker l'URL de redirection dans le localStorage | Permet de conserver l'URL de redirection m√™me apr√®s un rechargement de page |
| Ne pas mettre √† jour directement l'√©tat de session apr√®s la connexion | Mettre √† jour directement l'√©tat de session apr√®s la connexion | √âvite les probl√®mes de synchronisation entre le localStorage et l'√©tat de l'application |
| Essayer d'ins√©rer des donn√©es dans une table avec des politiques RLS restrictives | Cr√©er des objets en m√©moire si l'insertion √©choue √† cause des politiques RLS | Permet √† l'application de continuer √† fonctionner m√™me si les politiques RLS sont mal configur√©es |
| Ne pas g√©rer les erreurs de politique RLS | Intercepter et g√©rer les erreurs de politique RLS | √âvite les blocages de l'application en cas d'erreur de politique RLS |
| Ne pas d√©terminer automatiquement le r√¥le de l'utilisateur | D√©terminer le r√¥le en fonction de l'email ou d'autres attributs | Assure la coh√©rence des r√¥les m√™me si le profil n'existe pas dans la base de donn√©es |
| Utiliser single() pour r√©cup√©rer un enregistrement qui pourrait ne pas exister | Utiliser maybeSingle() pour √©viter les erreurs si aucun r√©sultat n'est trouv√© | √âvite les erreurs de type "multiple (or no) rows returned" |
| Ne pas v√©rifier la validit√© des param√®tres avant d'ex√©cuter une fonction | V√©rifier la validit√© des param√®tres au d√©but de la fonction | √âvite les erreurs dues √† des param√®tres invalides ou manquants |
| Cr√©er un profil par d√©faut uniquement dans la fonction getProfile | Cr√©er un profil par d√©faut √† plusieurs endroits strat√©giques | Assure qu'un profil par d√©faut est toujours disponible m√™me en cas d'erreur |
| Utiliser le m√™me nom pour un param√®tre et une variable locale | Utiliser des noms diff√©rents pour les param√®tres et les variables locales | √âvite les erreurs de r√©f√©rence comme "Cannot access variable before initialization" |
| Ne pas v√©rifier les conflits de noms de variables | Utiliser des noms descriptifs et uniques pour chaque variable | Am√©liore la lisibilit√© du code et √©vite les erreurs de r√©f√©rence |
| Utiliser router.push() pour les redirections apr√®s authentification | Utiliser window.location.replace() pour les redirections apr√®s authentification | Force un rechargement complet de la page et assure une redirection plus fiable |
| Ne pas ajouter de d√©lai avant la redirection | Ajouter un d√©lai suffisant (1000ms) avec setTimeout avant la redirection | Permet de s'assurer que la session est bien √©tablie avant la redirection |
| Ne pas stocker l'URL de redirection dans le localStorage | Stocker l'URL de redirection dans le localStorage | Permet de r√©cup√©rer l'URL de redirection m√™me apr√®s un rechargement de page |
| Ne pas stocker le r√¥le de l'utilisateur dans le localStorage | Stocker le r√¥le de l'utilisateur dans le localStorage | Permet d'acc√©der au r√¥le m√™me si la session Supabase n'est pas compl√®tement charg√©e |
| Faire une requ√™te √† la base de donn√©es pour d√©terminer le r√¥le dans le middleware | D√©terminer le r√¥le en fonction de l'email dans le middleware | Plus rapide et plus fiable, surtout en cas de probl√®mes avec les politiques RLS |
| Utiliser des m√©canismes de redirection complexes | Utiliser une approche directe avec redirection imm√©diate vers la page cible | √âvite les probl√®mes de synchronisation entre l'authentification et la redirection |
| Compter uniquement sur le contexte d'authentification pour le r√¥le | Stocker le r√¥le dans le localStorage avant m√™me la connexion | Permet d'acc√©der au r√¥le m√™me si le contexte d'authentification n'est pas encore charg√© |
| Utiliser des middleware trop restrictifs pendant le d√©veloppement | D√©sactiver temporairement certaines protections pour d√©boguer | Permet d'identifier plus facilement les probl√®mes de redirection et d'authentification |
| Importer des modules qui n'existent pas | V√©rifier l'existence des modules avant de les importer ou les cr√©er si n√©cessaire | √âvite les erreurs de build du type "Module not found" |
| Utiliser uniquement des hooks d'authentification complexes | Cr√©er des modules d'authentification simplifi√©s pour les composants qui n'ont pas besoin de toutes les fonctionnalit√©s | Am√©liore la performance et simplifie le code des composants |
| Compter uniquement sur le syst√®me d'authentification de Supabase | Utiliser des m√©canismes d'authentification alternatifs comme les cookies | Permet de contourner les probl√®mes de session Supabase |
| Stocker les informations d'authentification uniquement dans le localStorage | Stocker les informations d'authentification √† la fois dans le localStorage et les cookies | Permet au middleware d'acc√©der aux informations d'authentification |
| V√©rifier l'authentification uniquement avec Supabase dans le middleware | Accepter plusieurs m√©thodes d'authentification dans le middleware | Offre plus de flexibilit√© et de robustesse en cas de probl√®mes avec une m√©thode |
| Utiliser le m√™me syst√®me d'authentification dans tous les composants | Cr√©er un module d'authentification simplifi√©e et l'utiliser de mani√®re coh√©rente dans tous les composants | √âvite les incoh√©rences et les probl√®mes de synchronisation |
| Ne pas v√©rifier tous les composants qui utilisent l'authentification | V√©rifier tous les composants qui utilisent l'authentification lors du d√©bogage | Permet d'identifier les probl√®mes d'authentification dans tous les composants |
| Se concentrer uniquement sur le middleware pour r√©soudre les probl√®mes d'authentification | V√©rifier tous les points de contr√¥le d'authentification (middleware, layout, composants) | Permet d'identifier tous les points de blocage dans le flux d'authentification |
| Ignorer les logs du serveur et du client lors du d√©bogage | Analyser attentivement les logs du serveur et du client pour identifier les probl√®mes | Fournit des informations pr√©cieuses sur le flux d'ex√©cution et les erreurs |
| Supposer que les modifications du middleware s'appliquent imm√©diatement | Red√©marrer l'application apr√®s avoir modifi√© le middleware | Le middleware est charg√© au d√©marrage de l'application et n√©cessite un red√©marrage pour appliquer les modifications |
| Utiliser un syst√®me d'authentification complexe pour le d√©veloppement | Cr√©er un syst√®me d'authentification ultra-simplifi√© pour le d√©veloppement | Permet de se concentrer sur le d√©veloppement des fonctionnalit√©s sans √™tre bloqu√© par des probl√®mes d'authentification |
| D√©pendre de Supabase pour l'authentification pendant le d√©veloppement | Utiliser le localStorage pour stocker les informations d'authentification pendant le d√©veloppement | Simplifie le processus d'authentification et √©vite les probl√®mes de session |

### Tests

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|------------|--------------|---------------|
| Ne pas tester l'authentification | Cr√©er des scripts de test pour l'authentification | Permet de s'assurer que l'authentification fonctionne correctement |
| Ne pas tester avec diff√©rents r√¥les | Cr√©er des utilisateurs de test avec diff√©rents r√¥les | Permet de s'assurer que le contr√¥le d'acc√®s bas√© sur les r√¥les fonctionne correctement |
| Ne pas tester la cr√©ation de profil | V√©rifier que le profil est correctement cr√©√© lors de l'inscription | Permet de s'assurer que les profils sont correctement cr√©√©s |
| Ne pas tester la persistance de la session | V√©rifier que la session est correctement persist√©e apr√®s la connexion | Permet de s'assurer que l'utilisateur reste connect√© |

### Formulaires et validation

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Validation uniquement c√¥t√© client | Valider √©galement c√¥t√© serveur | La validation c√¥t√© client peut √™tre contour√©e, toujours valider c√¥t√© serveur |
| Messages d'erreur g√©n√©riques | Messages d'erreur sp√©cifiques | Les messages d'erreur doivent √™tre clairs et indiquer pr√©cis√©ment le probl√®me |
| Afficher des informations sensibles dans les erreurs | Messages d'erreur g√©n√©riques pour les erreurs sensibles | Ne pas r√©v√©ler d'informations sensibles dans les messages d'erreur |
| Ne pas d√©sactiver les boutons pendant le chargement | Ajouter un √©tat de chargement | Pr√©venir les soumissions multiples en d√©sactivant les boutons pendant le chargement |

## Erreurs d'architecture et de conception

### Structure du projet

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Tout dans un seul dossier | Structure modulaire | Organiser le code selon les modules fonctionnels |
| Composants trop grands | D√©composer en sous-composants | Suivre le principe de responsabilit√© unique |
| Duplication de code | DRY (Don't Repeat Yourself) | Extraire le code commun dans des fonctions utilitaires |
| Ignorer les tests | TDD ou tests apr√®s d√©veloppement | √âcrire des tests pour garantir la qualit√© du code |
| M√©langer la logique m√©tier et UI | S√©paration des pr√©occupations | S√©parer la logique m√©tier de l'interface utilisateur |
| Cr√©er tous les dossiers en une seule commande | Cr√©er les dossiers par groupes logiques | Facilite le d√©bogage et la v√©rification de la structure |
| Ignorer les caract√®res sp√©ciaux dans les noms de dossiers | Mettre les noms de dossiers avec caract√®res sp√©ciaux entre guillemets | Les parenth√®ses et autres caract√®res sp√©ciaux peuvent causer des probl√®mes |
| Ne pas v√©rifier la cr√©ation des dossiers | V√©rifier apr√®s chaque √©tape importante | S'assurer que la structure est correctement mise en place |

### Erreurs sp√©cifiques √† Next.js 13+

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Ignorer les conventions de nommage des dossiers sp√©ciaux | Utiliser correctement les parenth√®ses pour les groupes de routes | Les dossiers comme `(auth)` et `(dashboard)` sont des groupes de routes dans Next.js |
| Placer les composants au mauvais niveau | Suivre la structure recommand√©e | Les composants r√©utilisables doivent √™tre dans `/components`, pas dans les dossiers de routes |
| M√©langer les fichiers de page et les composants | S√©parer clairement les pages des composants | Les fichiers `page.tsx` sont sp√©ciaux dans Next.js App Router |

### Base de donn√©es

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Requ√™tes SQL brutes sans param√®tres | Utiliser les fonctions param√©tr√©es de Supabase | √âviter les injections SQL et faciliter la maintenance |
| Sch√©mas de base de donn√©es non normalis√©s | Normaliser les donn√©es | √âviter la redondance et les incoh√©rences |
| Ignorer les politiques de s√©curit√© RLS | Configurer Row Level Security | Contr√¥ler l'acc√®s aux donn√©es au niveau des lignes |
| Configurer des politiques RLS trop restrictives | Permettre aux utilisateurs d'ins√©rer leur propre profil | √âviter le probl√®me o√π un utilisateur ne peut pas cr√©er son profil car il n'a pas encore de profil |
| Ne pas tester les politiques RLS | Tester les politiques RLS avec diff√©rents r√¥les | S'assurer que les politiques fonctionnent correctement pour tous les cas d'utilisation |
| Exposer les cl√©s Supabase | Utiliser uniquement la cl√© publique c√¥t√© client | Ne jamais exposer la cl√© de service (service_role) c√¥t√© client |
| Oublier les index | Cr√©er des index pour les colonnes fr√©quemment utilis√©es | Am√©liorer les performances des requ√™tes |
| Ne pas utiliser les fonctionnalit√©s temps r√©el | Configurer les canaux de r√©altime | Profiter des fonctionnalit√©s de synchronisation en temps r√©el |
| Transactions manquantes | Utiliser des transactions | Assurer l'int√©grit√© des donn√©es pour les op√©rations complexes |

### API et Backend

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Endpoints non RESTful | Suivre les principes REST | Utiliser les m√©thodes HTTP appropri√©es (GET, POST, PUT, DELETE) |
| Validation c√¥t√© client uniquement | Valider c√¥t√© serveur | Toujours valider les donn√©es c√¥t√© serveur |
| Ignorer la gestion des erreurs | G√©rer toutes les erreurs | Retourner des codes d'erreur HTTP appropri√©s |
| Exposer des informations sensibles | Filtrer les donn√©es sensibles | Ne jamais exposer de mots de passe, tokens, etc. |
| Ignorer la pagination | Impl√©menter la pagination | Limiter la taille des r√©ponses pour les grandes collections |

## Erreurs de s√©curit√©

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Stockage de secrets en clair | Utiliser des variables d'environnement | Ne jamais committer de secrets dans le code source |
| Committer des fichiers .env | Utiliser .gitignore et .env.example | Exclure les fichiers .env* et inclure uniquement .env.example |
| Acc√©der directement √† process.env | Utiliser un module de configuration | Centraliser l'acc√®s aux variables d'environnement pour faciliter la maintenance |
| Ne pas valider les variables d'environnement | V√©rifier la pr√©sence des variables requises | Lancer une erreur explicite si une variable requise est manquante |
| Ne pas documenter les variables d'environnement | Cr√©er un README pour la configuration | Expliquer l'utilisation et le format de chaque variable |
| Ignorer HTTPS | Forcer HTTPS | Toujours utiliser HTTPS en production |
| Ignorer les injections XSS | √âchapper les donn√©es utilisateur | Utiliser des biblioth√®ques comme DOMPurify |
| Ignorer CSRF | Utiliser des tokens CSRF | Prot√©ger contre les attaques CSRF |
| Ignorer les en-t√™tes de s√©curit√© | Configurer les en-t√™tes | Utiliser Helmet.js ou √©quivalent |
| Permissions trop larges | Principe du moindre privil√®ge | Limiter les permissions au strict n√©cessaire |

## Erreurs de performance

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Images non optimis√©es | Utiliser next/image | Optimiser automatiquement les images |
| Bundle JS trop grand | Code splitting | Diviser le code en chunks plus petits |
| Rendu c√¥t√© client excessif | SSR/SSG quand possible | Utiliser le rendu c√¥t√© serveur quand appropri√© |
| Ignorer le caching | Impl√©menter le caching | Mettre en cache les donn√©es statiques ou qui changent peu |
| Re-renders inutiles | Utiliser memo, useMemo, useCallback | Optimiser les rendus avec la m√©morisation |
| Chargement synchrone | Chargement asynchrone | Utiliser le lazy loading pour les composants lourds |

## Erreurs de gestion de d√©pendances

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Trop de d√©pendances | √âvaluer la n√©cessit√© | N'ajouter que les d√©pendances vraiment n√©cessaires |
| Versions obsol√®tes | Mettre √† jour r√©guli√®rement | Maintenir les d√©pendances √† jour pour la s√©curit√© |
| Ignorer les vuln√©rabilit√©s | Auditer r√©guli√®rement | Ex√©cuter `npm audit` et corriger les probl√®mes |
| D√©pendances de d√©veloppement en production | S√©parer dev et prod | Utiliser correctement devDependencies et dependencies |
| Ignorer le verrouillage des versions | Utiliser package-lock.json | S'assurer que les versions sont coh√©rentes |

## Erreurs de d√©ploiement

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| D√©ployer sans tests | CI/CD avec tests | Automatiser les tests avant le d√©ploiement |
| Ignorer les variables d'environnement | Configurer correctement | S'assurer que toutes les variables d'environnement sont d√©finies |
| D√©ployer directement en production | Utiliser des environnements de staging | Tester d'abord dans un environnement similaire √† la production |
| Ignorer le monitoring | Mettre en place des outils de monitoring | Surveiller les performances et les erreurs |
| Ignorer les sauvegardes | Sauvegarder r√©guli√®rement | Mettre en place une strat√©gie de sauvegarde |

## Bonnes pratiques √† adopter

### D√©veloppement g√©n√©ral

1. **Toujours consulter la documentation** avant d'utiliser une nouvelle biblioth√®que ou API
2. **√âcrire des tests** pour les fonctionnalit√©s critiques
3. **Utiliser un linter et un formateur de code** pour maintenir la coh√©rence
4. **Faire des commits fr√©quents** avec des messages descriptifs
5. **Revoir le code** avant de le soumettre

### Next.js sp√©cifique

1. **Comprendre les diff√©rents modes de rendu** (SSR, SSG, ISR, CSR)
2. **Utiliser les composants optimis√©s** (Image, Link, etc.)
3. **Structurer les routes** selon la documentation officielle
4. **Optimiser pour le SEO** quand n√©cessaire
5. **Utiliser les API routes** pour les fonctionnalit√©s backend

### React sp√©cifique

1. **Penser en composants** et favoriser la r√©utilisation
2. **Utiliser les hooks correctement** et comprendre leur cycle de vie
3. **√âviter les effets de bord** dans les composants
4. **G√©rer l'√©tat global** avec des outils appropri√©s (Context, Redux, Zustand, etc.)
5. **Optimiser les rendus** pour √©viter les performances m√©diocres

## Proc√©dure avant de coder

1. **Consulter le plan.md** pour comprendre le contexte
2. **Lire les instructions.md** pour conna√Ætre l'architecture
3. **V√©rifier ce document** pour √©viter les erreurs connues
4. **Planifier l'approche** avant de commencer √† coder
5. **Pr√©parer les tests** si possible avant l'impl√©mentation

## Erreurs li√©es √† Supabase

### Cr√©ation et gestion des tables

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Cr√©er des tables sans v√©rifier les tables existantes | Lister les tables existantes avant d'en cr√©er de nouvelles | √âviter les conflits et les doublons |
| Oublier d'activer Row Level Security (RLS) | Activer RLS sur toutes les tables | Assurer la s√©curit√© des donn√©es |
| Cr√©er des contraintes sans v√©rifier leur validit√© | Tester les contraintes avant de les appliquer | √âviter les erreurs lors de l'insertion de donn√©es |
| Ignorer les types de donn√©es | D√©finir pr√©cis√©ment les types de donn√©es | Assurer l'int√©grit√© des donn√©es |
| Oublier les valeurs par d√©faut | D√©finir des valeurs par d√©faut appropri√©es | Faciliter l'insertion de donn√©es |

### Migrations et modifications de sch√©ma

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Modifier directement les tables en production | Utiliser des migrations | Garder une trace des modifications et pouvoir les annuler |
| Cr√©er des migrations sans les tester | Tester les migrations sur un environnement de d√©veloppement | √âviter les erreurs en production |
| Ignorer les d√©pendances entre tables | Respecter l'ordre des migrations | √âviter les erreurs de contraintes de cl√© √©trang√®re |
| Oublier de v√©rifier les colonnes existantes | V√©rifier la structure des tables avant de les modifier | √âviter les erreurs lors des modifications |
| Ignorer les erreurs de migration | G√©rer les erreurs et les corriger | √âviter les √©tats inconsistants |

### Insertion de donn√©es

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Ins√©rer des donn√©es sans v√©rifier les contraintes | V√©rifier les contraintes avant l'insertion | √âviter les erreurs d'insertion |
| Ignorer les cl√©s √©trang√®res | S'assurer que les donn√©es r√©f√©renc√©es existent | Maintenir l'int√©grit√© r√©f√©rentielle |
| Ins√©rer des donn√©es en masse sans transaction | Utiliser des transactions pour les insertions en masse | Assurer l'atomicit√© des op√©rations |
| Ignorer les erreurs d'insertion | G√©rer les erreurs et les corriger | √âviter les √©tats inconsistants |
| Ins√©rer des donn√©es sans v√©rifier leur validit√© | Valider les donn√©es avant l'insertion | Assurer la qualit√© des donn√©es |

### Client Supabase

| ‚ùå Erreur | ‚úÖ Correction | üìù Explication |
|----------|--------------|---------------|
| Exposer la cl√© secr√®te dans le code client | Utiliser uniquement la cl√© anonyme c√¥t√© client | Prot√©ger les informations sensibles |
| Ignorer la gestion des erreurs | G√©rer les erreurs de mani√®re appropri√©e | Am√©liorer l'exp√©rience utilisateur |
| R√©p√©ter les m√™mes requ√™tes | Utiliser la mise en cache et SWR | Optimiser les performances |
| Ignorer les types TypeScript | D√©finir des types pr√©cis pour les tables | √âviter les erreurs √† l'ex√©cution |
| Cr√©er plusieurs instances du client | R√©utiliser la m√™me instance | √âviter les fuites de m√©moire |

Ce document est √©volutif et sera mis √† jour au fur et √† mesure que de nouvelles erreurs sont identifi√©es ou que de nouvelles bonnes pratiques √©mergent.
